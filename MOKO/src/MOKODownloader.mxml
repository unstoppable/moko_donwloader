<?xml version="1.0" encoding="utf-8"?>
<s:WindowedApplication xmlns:fx="http://ns.adobe.com/mxml/2009"  applicationComplete="applicationCompleteHandler(event)"
					   xmlns:s="library://ns.adobe.com/flex/spark" 
					   showStatusBar="false" fontFamily="微软雅黑" 
					   xmlns:mx="library://ns.adobe.com/flex/mx" width="960" height="640" xmlns:local="*">
	
	<fx:Script>
		<![CDATA[
			import air.update.ApplicationUpdaterUI;
			import air.update.events.UpdateEvent;
			
			import mx.events.FlexEvent;
			import mx.logging.Log;
			import mx.logging.LogEventLevel;
			import mx.logging.targets.TraceTarget;
			protected function mainview1_completeHandler(event:Event):void
			{
				login.visible=false;
			}
			
			protected function applicationCompleteHandler(event:FlexEvent):void
			{
				URLRequestDefaults.manageCookies=true;
				URLRequestDefaults.userAgent='Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.46 Safari/536.5';
				initLogging();
				this.checkUpdate();
			}
			protected var appUpdater:ApplicationUpdaterUI=new ApplicationUpdaterUI(); // Used for auto-update
			
			
			// Initialize appUpdater and set some properties
			[Bindable]
			private var info:String;
			protected function checkUpdate():void
			{
				// set the URL for the update.xml file
				appUpdater.updateURL="http://www.raisedtech.com/moko/moko.update.xml";
				appUpdater.addEventListener(UpdateEvent.INITIALIZED, onUpdate);
				appUpdater.addEventListener(ErrorEvent.ERROR, onUpdaterError);
				appUpdater.isCheckForUpdateVisible=false;
				appUpdater.isFileUpdateVisible=false;
				appUpdater.isInstallUpdateVisible=false;
				appUpdater.initialize();
			}
			
			// Handler function triggered by the ApplicationUpdater.initialize.
			// The updater was initialized and it is ready to take commands.
			protected function onUpdate(event:UpdateEvent):void
			{
				// start the process of checking for a new update and to install
				trace(event);
				appUpdater.checkNow();
			}
			
			// Handler function for error events triggered by the ApplicationUpdater.initialize
			protected function onUpdaterError(event:ErrorEvent):void
			{
				trace(event);
			}
			
			private function initLogging():void
			{
				/* Create a target. */
				var logTarget:TraceTarget=new TraceTarget();
				logTarget.level=LogEventLevel.ALL;
				logTarget.includeDate=false;
				logTarget.includeTime=true;
				logTarget.includeCategory=true;
				logTarget.includeLevel=true;
				
				/* Begin logging. */
				Log.addTarget(logTarget);
			}
			
			protected function button1_clickHandler(event:MouseEvent):void
			{
				help.visible=false;
			}
			
			protected function spiderview1_cancelHandler(event:Event):void
			{
				// TODO Auto-generated method stub
				help.visible=true;
			}
			
		]]>
	</fx:Script>
	
	
	<local:MainView id="login" width="100%" height="100%" complete="mainview1_completeHandler(event)" />
	
	<local:SpiderView visible="{!login.visible}" width="100%" height="100%" cancel="spiderview1_cancelHandler(event)" />
	<s:Group id="help" visible="false" width="100%" height="100%" >
		<s:Rect width="100%" height="100%" >
			<s:fill>
				<s:SolidColor alpha="0.3" color="0" />
			</s:fill>
		</s:Rect>
		<s:Image smooth="true" source="@Embed('help.jpg')" x="0" y="40" />
		<s:Button x="883" y="42" label="关闭" click="button1_clickHandler(event)" emphasized="true" chromeColor="0x22aa22"/>
	</s:Group>
	
</s:WindowedApplication>
